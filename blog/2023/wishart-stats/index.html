<!DOCTYPE html>
<html>

  <head>
    
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>

  Maren  Mahsereci


  | Covariance of the Wishart distribution

</title>
<meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design.
">

<!-- Open Graph -->


<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" integrity="sha512-RO38pBRxYH3SoOprtPTD86JFOclM51/XTIdEPh5j8sj4tp8jmQIx26twG52UaLi//hQldfrh7e51WzP9wuP32Q==" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

<!-- Code Syntax Highlighting -->
<link rel="stylesheet" href="https://gitcdn.link/repo/jwarby/jekyll-pygments-themes/master/github.css" />

<!-- Styles -->

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>Ω</text></svg>">

<link rel="stylesheet" href="/assets/css/main.css">
<link rel="canonical" href="/blog/2023/wishart-stats/">


<!-- Dark Mode -->
<script src="/assets/js/theme.js"></script>
<script src="/assets/js/dark_mode.js"></script>



  </head>

  <body class="fixed-top-nav ">

    <!-- Header -->

    <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
    <div class="container">
      
      <a class="navbar-brand title font-weight-lighter" href="https://mmahsereci.github.io/">
       <span class="font-weight-bold">Maren</span>   Mahsereci
      </a>
      
      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">
              about
              
            </a>
          </li>
          
          <!-- Blog -->
          <li class="nav-item active">
            <a class="nav-link" href="/blog/">
              <!-- I changed this -->
              posts
              
            </a>
          </li>
          
          <!-- Other pages -->
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/projects/">
                projects
                
              </a>
          </li>
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/publications/">
                publications
                
              </a>
          </li>
          
          
          
          
          
          
          
          
          
          
            <div class="toggle-container">
              <a id="light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
              </a>
            </div>
          
        </ul>
      </div>
    </div>
  </nav>

</header>


    <!-- Content -->

    <div class="container mt-5">
      





<div class="post">

  <header class="post-header">
    <h1 class="post-title">Covariance of the Wishart distribution</h1>
    <p class="post-meta">April 27, 2023 • mmahsereci</p>
    <p class="post-tags">
      <a href="/blog/2023"> <i class="fas fa-calendar fa-sm"></i> 2023 </a>
      
        ·  
        
        <a href="/blog/tag/machinelearning">
          <i class="fas fa-hashtag fa-sm"></i> machinelearning</a>  
          
      

      
        ·  
        
        <a href="/blog/category/techblog">
          <i class="fas fa-tag fa-sm"></i> techblog</a>  
          
      

    </p>
  </header>

  <article class="post-content">
    <p>The covariance of the elements of a Wishart distributed \(n\times n\) random matrix \(A\sim\mathcal{W}_n(V, \nu)\) 
is related to a <a href="/blog/2022/kronecker-sym/">symmetric Kronecker product</a></p>

\[\mathrm{Cov}[A_{ij}, A_{kl}] = 2\nu (V\circledast V)_{(ij), (kl)},\]

<p>where ‘\(\circledast\)’ denotes the symmetric Kronecker product. 
I have tried to locate derivations of the above relation, but they seem quite hard to find.
As the relation seems to pop up here and there and seems to be quite useful I did my own derivation
which this post is about.</p>

<blockquote>
  <p><em>Disclaimer:</em> No one checked my the derivation below for errors, and I was tired when writing this up, so beware of possible mistakes (though I hope it’s correct).</p>
</blockquote>

<h2 id="preliminaries-the-wishart-distribution">Preliminaries: The Wishart distribution</h2>

<p>The support of the Wishart distribution \(\mathcal{W}_n(V, \nu)\) are symmetric positive definite \(n\times n\) matrices \(A\). 
The distribution is parametrized by a positive definite \(n\times n\) matrix \(V\), and the degrees of freedom \(\nu&gt;n-1.\)
Its density is</p>

\[p(A) = \frac{\det(A)^{\frac{\nu-n - 1}{2}} e^{-\frac{1}{2}\mathrm{tr}(V^{-1}A)}}{ 2^{\frac{\nu n}{2}}\det(V)^{\frac{\nu}{2}} \Gamma_n\left(\frac{\nu}{2}\right)}
  \quad\text{with}\quad
  \Gamma_n\left(\frac{\nu}{2}\right) = \pi^{\frac{n(n-1)}{4}} \prod_{i=1}^n \Gamma\left(\frac{\nu}{2} - \frac{i-1}{2}\right).\]

<p>The random matrices \(A\) can equally be constructed as sums of outer products of normally distributed 
\(n\)-dimensional vectors \(u\sim \mathcal{N}(0, V)\) with covariance matrix \(V\) according to</p>

\[A = \sum_{\alpha=1}^\nu u^{\alpha} u^{\alpha\intercal}.\]

<p>Simply for notational convenience, I will also use the vectorized notation \(\overrightarrow{A}\) which are the rows of \(A\) stacked into a vector.</p>

<h2 id="derivation-of-the-mean-of-a-wishart">Derivation of the mean of a Wishart</h2>

<p>To derive the mean \(\mathbb{E}[\overrightarrow{A}]\) we use the construction \(A = \sum_{\alpha=1}^\nu u^{\alpha} u^{\alpha\intercal}\) with \(u\sim \mathcal{N}(0, V)\)
as mentioned.</p>

\[\begin{equation*}
  \begin{split}
     \mathbb{E}[A_{ij}]
    &amp;=  \mathbb{E}\left[\left[\sum_{\alpha=1}^\nu  u^{\alpha} u^{\alpha\intercal}\right]_{ij}\right]\\
    &amp;=  \mathbb{E}\left[\sum_{\alpha=1}^\nu u^{\alpha}_i u^{\alpha}_j\right]\\
    &amp;= \sum_{\alpha=1}^\nu  \mathbb{E}\left[ u^{\alpha}_i u^{\alpha}_j\right]\\
    &amp;= \sum_{\alpha=1}^\nu  V_{ij}\\ 
    &amp;= \nu  V_{ij}
  \end{split}
\end{equation*}\]

<p>The second to last line uses \(V_{ij} = \mathrm{Cov}[ u_i,  u_j] = \mathbb{E}[ u_i u_j]  -  \mathbb{E}[u_i] \mathbb{E}[u_j] = \mathbb{E}[ u_i u_j] - 0\cdot 0 = \mathbb{E}[ u_i u_j]\).</p>

<h2 id="derivation-of-the-covariance-of-a-wishart">Derivation of the covariance of a Wishart</h2>

<p>Likewise for the covariance \(\mathrm{Cov}[\overrightarrow{A}]\) we get</p>

\[\begin{equation*}
  \begin{split}
    \mathrm{Cov}[A_{ij}, A_{kl}]
    &amp;=  \mathbb{E}[A_{ij}A_{kl}] -    \mathbb{E}[A_{ij}]   \mathbb{E}[A_{kl}]\\ 
    &amp;=  \mathbb{E}[A_{ij}A_{kl}] -   \nu^2  V_{ij}  V_{kl}\\ 
    &amp;=  \mathbb{E}\left[\left[\sum_{\beta=1}^\nu  u^{\beta} u^{\beta\intercal}\right]_{ij} \left[\sum_{\alpha=1}^\nu  u^{\alpha} u^{\alpha\intercal}\right]_{kl}\right]
    - \nu^2  V_{ij}  V_{kl}\\ 
    &amp;=  \mathbb{E}\left[\sum_{\alpha,\beta=1}^\nu u^{\beta}_{i} u^{\beta}_{j} u^{\alpha}_{k} u^{\alpha}_{l} \right]
    -   \nu^2  V_{ij}  V_{kl}\\ 
    &amp; = \sum_{\alpha,\beta=1}^\nu  \mathbb{E}\left[ u^{\beta}_{i} u^{\beta}_{j} u^{\alpha}_{k} u^{\alpha}_{l} \right]
    -   \nu^2  V_{ij}  V_{kl}\\ 
    &amp; = \nu [ V_{ik}  V_{jl} +  V_{il}  V_{jk}]
     + \nu^2  V_{ij}  V_{kl}     
     - \nu^2  V_{ij}  V_{kl}\\ 
    &amp; = \nu [ V_{ik}  V_{jl} +  V_{il}  V_{jk}] \\
    &amp; = 2\nu (V \circledast V)_{(ij), (kl)}
   \end{split}
\end{equation*}\]

<p>In the second line we used the result of the mean \(\mathbb{E}[A_{il}] = \nu  V_{ij}\).
In the third line we use the construction \(A = \sum_{\alpha=1}^\nu u^{\alpha} u^{\alpha\intercal}\) with \(u\sim \mathcal{N}(0, V)\).
In the last line we used the definition of the symmetric Kronecker product 
\((\Xi\circledast \Xi)_{(ij), (kl)} = \frac{1}{2}(\Xi_{ik}\Xi_{jl} + \Xi_{jk}\Xi_{il})\)
(see also <a href="/blog/2022/kronecker-sym/">this</a> post). 
From fifth to sixth line we used the following derivation:</p>

\[\begin{equation*}
  \begin{split}
    \sum_{\alpha,\beta=1}^\nu
     \mathbb{E}[ u^{\beta}_{i} u^{\beta}_{j}  u^{\alpha}_{k} u^{\alpha}_{l}]
     &amp; = \sum_{\alpha,\beta=1}^\nu  \mathbb{E}[ u^{\beta}_{i} u^{\beta}_{j}  u^{\alpha}_{k} u^{\alpha}_{l}] \delta_{\alpha\beta}
     + \sum_{\alpha,\beta=1, \alpha\neq\beta}^\nu  \mathbb{E}[ u^{\beta}_{i} u^{\beta}_{j}u^{\alpha}_{k} u^{\alpha}_{l}]\\
     &amp; = \sum_{\alpha=1}^\nu  \mathbb{E}[ u^{\alpha}_{i} u^{\alpha}_{j}  u^{\alpha}_{k} u^{\alpha}_{l}]
     + \sum_{\alpha,\beta=1, \alpha\neq\beta}^\nu  \mathbb{E}[ u^{\beta}_{i} u^{\beta}_{j}]  \mathbb{E}[ u^{\alpha}_{k} u^{\alpha}_{l}]\\
     &amp; = \sum_{\alpha=1}^\nu [ V_{ij}  V_{kl} +  V_{ik}  V_{jl} +  V_{il}  V_{jk}]
     + \sum_{\alpha,\beta=1, \alpha\neq\beta}^\nu V_{ij}  V_{kl}\\
     &amp; = \sum_{\alpha=1}^\nu [ V_{ij}  V_{kl} +  V_{ik}  V_{jl} +  V_{il}  V_{jk}]
     + \sum_{\alpha,\beta=1}^\nu V_{ij}  V_{kl}
     - \sum_{\alpha=1}^\nu V_{ij}  V_{kl}\\
     &amp; = \nu [ V_{ij}  V_{kl} +  V_{ik}  V_{jl} +  V_{il}  V_{jk}]
     + \nu^2  V_{ij}  V_{kl}
     - \nu   V_{ij}  V_{kl}\\
     &amp; = \nu [ V_{ik}  V_{jl} +  V_{il}  V_{jk}]
     + \nu^2  V_{ij}  V_{kl}.
  \end{split}
\end{equation*}\]

<p>In the first line we split the sum into terms where \(\alpha=\beta\) and \(\alpha\neq\beta\).
In the second line and second term we used that \(u^{\alpha}\) and \(u^{\beta}\) were drawn independently if \(\alpha\neq \beta\);
the first term simplifies due to the Kronecker delta \(\delta_{\alpha\beta}\).
In the third line we use two simplifications: The first one ist the fourth moment of a multivariate Gaussian; that is if 
\(x\sim\mathcal{N}(0, \Sigma)\) with \(\sigma_{ij}\) the \(ij\)-th element
of the covariance matrix \(\Sigma\) then \(\mathbb{E}[x_ix_j x_k x_l] = \sigma_{ij} \sigma_{kl} + \sigma_{ik} \sigma_{jl} + \sigma_{il} \sigma_{jk}\). 
The second one is that \(V_{ij} = \mathrm{Cov}[ u_i,  u_j] = \mathbb{E}[ u_i u_j]\) as already used above. Now the terms in the sums
do not depend on \(\alpha\) and \(\beta\) anymore, thus we only collect terms in the last three lines.</p>

<h2 id="summary">Summary</h2>

<p>The results for the mean, variance and covariance are hence</p>

\[\begin{equation*}
\begin{split}
  \mathbb{E}[A_{ij}] 
  &amp;= \nu V_{ij} \\
  \mathrm{Var}[A_{ij}]
  &amp;= \nu [ V_{ii}  V_{jj} +  V_{ij}^2]\\
  \mathrm{Cov}[A_{ij}, A_{kl}] 
  &amp;= \nu [ V_{ik}  V_{jl} +  V_{il}  V_{jk}] \\
\end{split}
\end{equation*}\]

<p>where we also used that \(V_{ij}=V_{ji}\).</p>

<p>With the definition of the symmetric Kronecker product we obtain the vectorized versions</p>

\[\begin{equation*}
\begin{split}
   \mathbb{E}[\overrightarrow{A}] &amp; = \nu \overrightarrow{V}\\
  \mathrm{Cov}[\overrightarrow{A}] &amp; = 2\nu (V\circledast V),
\end{split}
\end{equation*}\]

<p>where \(\overrightarrow{A}\) is an \(n^2\)-dimensional vector as mentioned (rows of \(A\) are stacked),
and the associated covariance matrix is a symmetric Kronecker product of shape \(n^2\times n^2\).</p>


  </article>

  

</div>

    </div>

    <!-- Footer -->

    
<footer class="fixed-bottom">
  <div class="container mt-0">
    © Copyright 2024 Maren  Mahsereci.
    Powered by <a href="http://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>.

    
    
  </div>
</footer>



  </body>

  <!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>

  <!-- Bootsrap & MDB scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js" integrity="sha512-eUQ9hGdLjBjY3F41CScH3UX+4JDSI9zXeroz7hJ+RteoCaY+GP/LDoM8AO+Pt+DRFw3nXqsjh9Zsts8hnYv8/A==" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha512-M5KW3ztuIICmVIhjSqXe01oV2bpe248gOxqmlcYrEzAvws7Pw3z6BK0iGbrwvdrUQUhi3eXgtxp5I8PDo9YfjQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js" integrity="sha512-Mug9KHKmroQFMLm93zGrjhibM2z2Obg9l6qFG2qKjXEXkMp/VDkI4uju9m4QKPjWSwQ6O2qzZEnJDEeCw0Blcw==" crossorigin="anonymous"></script>

  
<!-- Mansory & imagesLoaded -->
<script defer src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script defer src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script defer src="/assets/js/mansory.js" type="text/javascript"></script>


  


<!-- Medium Zoom JS -->
<script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
<script src="/assets/js/zoom.js"></script>


<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>

  
<!-- MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>
<script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
<script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


  





</html>
